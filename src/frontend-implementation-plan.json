{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Add cash payment option with change calculation",
  "requirements": [
    {
      "id": "REQ-2",
      "summary": "Update frontend payment method types and mappers to support 'cash' payment method",
      "acceptanceCriteria": [
        "Frontend PaymentMethod type includes 'cash' option",
        "Mappers correctly convert between frontend 'cash' and backend 'dinheiro'",
        "Portuguese label 'Dinheiro' displays in the UI"
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/pos/payment.ts",
          "operation": "modify",
          "description": "Add 'cash' to the PaymentMethod type definition and ensure it maps to 'dinheiro' label in Portuguese"
        },
        {
          "path": "frontend/src/backend/mappers.ts",
          "operation": "modify",
          "description": "Update toBackendPaymentMethod and fromBackendPaymentMethod functions to handle 'cash' to 'dinheiro' conversion between frontend and backend types"
        },
        {
          "path": "frontend/src/i18n/ptBR.ts",
          "operation": "modify",
          "description": "Add 'Dinheiro' label to payment method translations for the cash payment option"
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Add cash payment button to CheckoutPanel alongside existing payment method buttons",
      "acceptanceCriteria": [
        "Cash payment button appears in checkout panel",
        "Button is visually consistent with other payment method buttons",
        "Selecting cash enables the change calculation flow"
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/pos/CheckoutPanel.tsx",
          "operation": "modify",
          "description": "Add a fourth payment method button for 'Dinheiro' (cash) alongside PIX, Debit, and Credit buttons; ensure it triggers the change calculation UI when selected"
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Implement change calculation interface when cash payment is selected",
      "acceptanceCriteria": [
        "Input field accepts the cash amount tendered by customer",
        "Change amount is calculated as (tendered amount - cart total)",
        "Change is displayed in BRL currency format",
        "Validation prevents completing sale if tendered amount is less than total",
        "Change calculation updates in real-time as user types"
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/pos/CheckoutPanel.tsx",
          "operation": "modify",
          "description": "Add conditional UI that appears when cash payment is selected, including an input field for amount tendered, real-time change calculation display in BRL format, and validation that disables the complete sale button when tendered amount is insufficient"
        },
        {
          "path": "frontend/src/features/pos/payment.ts",
          "operation": "modify",
          "description": "Add utility functions for cash payment validation and change calculation (tendered amount minus total)"
        }
      ]
    },
    {
      "id": "REQ-5",
      "summary": "Update cash register reporting to include cash payment method in breakdown calculations",
      "acceptanceCriteria": [
        "Cash register close panel displays cash payment totals separately",
        "Cash closing history shows cash payment amounts",
        "Payment method breakdown calculations include cash transactions"
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/cashregister/reporting.ts",
          "operation": "modify",
          "description": "Update calculatePaymentMethodBreakdown function to include cash payment calculations alongside credit, debit, and PIX"
        },
        {
          "path": "frontend/src/features/cashregister/CashClosePanel.tsx",
          "operation": "modify",
          "description": "Add display row for cash payment totals in the payment method breakdown section"
        },
        {
          "path": "frontend/src/features/cashregister/ClosingsHistoryList.tsx",
          "operation": "modify",
          "description": "Update closing records display to show cash payment amounts in the payment method breakdown"
        }
      ]
    },
    {
      "id": "REQ-6",
      "summary": "Update sales history display to show cash payment method",
      "acceptanceCriteria": [
        "Sales paid with cash display 'Dinheiro' as payment method",
        "Sales history correctly shows all four payment methods"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/SalesHistoryPage.tsx",
          "operation": "modify",
          "description": "Ensure sales records correctly display 'Dinheiro' label for cash payments alongside existing payment methods (PIX, Debit, Credit)"
        }
      ]
    }
  ]
}